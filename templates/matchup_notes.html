{% extends 'base.html' %}

{% block head %}
<title>Matchup Notes</title>
{% endblock %}

{% block body %}
<h1>Matchup Notes</h1>

<form method="GET" id="characterForm">
    <!-- My Character -->
    <label for="my_character">My Character:</label>
    <select name="my" onchange="document.getElementById('characterForm').submit()">
        <option value="" disabled {% if not my_id %}selected{% endif %}>Select your character</option>
        {% for char in characters %}
            {% if char.id != opp_id %}
                <option value="{{ char.id }}" {% if char.id == my_id %}selected{% endif %}>
                    {{ char.name }}
                </option>
            {% endif %}
        {% endfor %}
    </select>

    <!-- Opponent Character -->
    <label for="opponent_character">Opponent's Character:</label>
    <select name="opp" onchange="document.getElementById('characterForm').submit()">
        <option value="" disabled {% if not opp_id %}selected{% endif %}>Select opponent character</option>
        {% for char in characters %}
            {% if char.id != my_id %}
                <option value="{{ char.id }}" {% if char.id == opp_id %}selected{% endif %}>
                    {{ char.name }}
                </option>
            {% endif %}
        {% endfor %}
    </select>
</form>

{% if my_id and opp_id %}
  <form method="POST">
      <br>
      <textarea name="content" placeholder="Enter your matchup notes here..." required>{{ content or '' }}</textarea>
      <br>
      <input type="hidden" name="my_character_id" value="{{ my_id }}">
      <input type="hidden" name="opponent_character_id" value="{{ opp_id }}">
      <br>
      <button type="submit">Save Note</button>
  </form>
{% endif %}

<div>
    {% if matchup_notes %}
      <hr>
      <h2>Notes for {{ my_id }} vs {{ opp_id }}</h2>
      <ul>
        {% for line in matchup_notes %}
          <li>{{ line.content }}</li>
        {% endfor %}
      </ul>
    {% if my_char and opp_char %}
        {% set character = my_char %}
        <h2>My Character: {{ character.name }}</h2>
        <button onclick="toggleVisibility('{{ character.id }}', this)" data-state="hidden">Show All</button>
        <button onclick="toggleMovesWithNotes('{{ character.id }}', this)" data-state="hidden">Show Moves With Notes</button>
        <button onclick="toggleMovesWithoutNotes('{{ character.id }}',this)" data-state="hidden">Show Moves Without Notes</button>
        <button type="button" onclick="resetFilter('{{ character.id }}')">Reset Filter</button>
        <label for="move-filter-{{ character.id }}">Filter Moves:</label>
        <select id="move-filter-{{ character.id }}" multiple>
            {% for move in character.moves %}
                <option value="{{ move.id }}">{{ move.name }}</option>
            {% endfor %}
        </select>
        <div id="move-table-{{ character.id }}" style="display: none;">
            {% include 'move_table.html' %}
        </div>

        {% set character = opp_char %}
        <h2>Opponent Character: {{ character.name }}</h2>
        <button onclick="toggleVisibility('{{ character.id }}', this)" data-state="hidden">Show All</button>
        <button onclick="toggleMovesWithNotes('{{ character.id }}', this)" data-state="hidden">Show Moves With Notes</button>
        <button onclick="toggleMovesWithoutNotes('{{ character.id }}', this)" data-state="hidden">Show Moves Without Notes</button>
        <button type="button" onclick="resetFilter('{{ character.id }}')">Reset Filter</button>
        <label for="move-filter-{{ character.id }}">Filter Moves:</label>
        <select id="move-filter-{{ character.id }}" multiple>
            {% for move in character.moves %}
                <option value="{{ move.id }}">{{ move.name }}</option>
            {% endfor %}
        </select>
        <div id="move-table-{{ character.id }}" style="display: none;">
            {% include 'move_table.html' %}
        </div>
    {% endif %}
    {% else %}
      <p>No notes for this matchup yet.</p>
    {% endif %}
</div>
{% endblock %}