<div data-character-id="{{ character.id }}">
{% for move in character.moves %}
<div data-move-id="{{ move.id }}">
<div class="movedata-container">
    <div class="movedata-flex-image-container">
        <div>
            <div>
                <big>{{ move.name|replace('\n', '<br>')|safe }}</big>
            </div>
            <div>
                <a href="" class="image" title="{{ move.name|replace('\n', '<br>')|safe }}"></a>
            </div>
        </div>
        <div class="movedata-flex-images">
        </div>
    </div>
    <div class="movedata-flex-information">
        <div class="movedata-flex-framedata">
            <table class="wikitable movedata-flex-framedata-table">
            <tr>
                <th>Damage</th>
                <th>Guard</th>
                <th>Cancel</th>
                <th>Property</th>
                <th>Cost</th>
                <th>Attribute</th>
            </tr>
            <tr>
                <td>{{ move.damage|replace('\n', '<br>')|safe }}</td>
                <td>{{ move.guard|replace('\n', '<br>')|safe }}</td>
                <td>{{ move.cancel|replace('\n', '<br>')|safe }}</td>
                <td>{{ move.move_property|replace('\n', '<br>')|safe }}</td>
                <td>{{ move.cost|replace('\n', '<br>')|safe }}</td>
                <td>{{ move.attribute|replace('\n', '<br>')|safe }}</td>
            </tr>    
            <tr>    
                <th>First Active</th>
                <th>Active</th>
                <th>Recovery</th>
                <th>Overall</th>
                <th>Advantage</th>
                <th>Invul</th>
            </tr>
            <tr>
                <td>{{ move.startup|replace('\n', '<br>')|safe }}</td>
                <td>{{ move.active|replace('\n', '<br>')|safe }}</td>
                <td>{{ move.recovery|replace('\n', '<br>')|safe }}</td>
                <td>{{ move.overall|replace('\n', '<br>')|safe }}</td>
                <td>{{ move.advantage|replace('\n', '<br>')|safe }}</td>
                <td>{{ move.invulnerability|replace('\n', '<br>')|safe }}</td>
            </tr>
            </table>
        </div>
        {% if request.endpoint == 'matchup_notes' %}
        <div class="matchup-notes-container">
            {% if request.endpoint == 'matchup_notes' %}
            <!-- Display existing note -->
            <div id="note-display-{{ move.id }}">
                {% if move_notes.get(move.id) %}
                    <ul>
                        {% for line in move_notes.get(move.id).splitlines() if line.strip() %}
                            <li>{{ line }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p><em>No notes yet.</em></p>
                {% endif %}
            </div>
            <div style="display: flex; gap: 8px; margin-top: 8px; align-items: center;">
                <!-- Hidden form to create/edit note -->
                <form id="note-form-{{ move.id }}" method="POST" action="{{ url_for('save_move_note') }}" style="display: none; margin-top: 5px;" onsubmit="saveUIState('{{ character.id }}')">
                    {% set note = move_notes.get(move.id, '') %}
                    {% set count = note.splitlines() | length %}
                    <textarea name="content" rows="{{ count if count > 2 else 2 }}" cols="30" placeholder="Enter your note..." data-original="{{ move_notes.get(move.id, '').strip() }}">{{ move_notes.get(move.id, '').strip() }}</textarea>
                    <input type="hidden" name="move_id" value="{{ move.id }}">
                    <input type="hidden" name="my_character_id" value="{{ my_id }}">
                    <input type="hidden" name="opponent_character_id" value="{{ opp_id }}">
                    <div style="margin-top: 5px;">
                        <button type="submit">Save</button>
                    </div>
                </form>
            </div>
            <!-- Button to toggle form -->
            <button type="button" id="toggle-button-{{ move.id }}" onclick="toggleNoteForm({{ move.id }})">
                {{ 'Edit Note' if move_notes.get(move.id) else 'Add Note' }}
            </button>
            {% if move_notes.get(move.id) %}
            <form method="POST" action="{{ url_for('delete_move_note') }}" onsubmit="return confirm('Delete this note?')">
                <input type="hidden" name="move_id" value="{{ move.id }}">
                <input type="hidden" name="my_id" value="{{ my_id }}">
                <input type="hidden" name="opp_id" value="{{ opp_id }}">
                <button type="submit">Delete Note</button>
                {% endif %}
            </form>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
<br>
</div>
{% endfor %}
</div>