<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    {% block head %}{% endblock %}
</head>
<body>
<div>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="flashes">
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
</div>
<div class="top-nav">
    {% if request.path != '/' %}
        <a href="{{ url_for('index') }}">Home</a>
    {% endif %}
</div>
    {% block body %}{% endblock %}

    <script>
    function toggleTable(characterId, show) {
        const tableDiv = document.getElementById('move-table-' + characterId);
        if (tableDiv) {
            tableDiv.style.display = show ? 'block' : 'none';
        }

        // Clear the Tom Select dropdown filter
        const select = document.getElementById('move-filter-' + characterId);
        if (select && select.tomselect) {
            select.tomselect.clear(true);  // Clears selected values
        }

        // Also reset all move divs to show/hide based on action
        tableDiv.querySelectorAll('div[data-move-id]').forEach(div => {
            div.style.display = show ? 'block' : 'none';
        });
    }
    </script>
    <script>
    function filterMoves(characterId) {
        const select = document.getElementById(`move-filter-${characterId}`);
        const selected = Array.from(select.selectedOptions).map(opt => opt.value);

        const tableDiv = document.getElementById(`move-table-${characterId}`);
        tableDiv.style.display = 'block';  // Make sure table shows up

        tableDiv.querySelectorAll(`div[data-move-id]`).forEach(div => {
            div.style.display = selected.includes(div.dataset.moveId) ? 'block' : 'none';
        });
    }
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('select[id^="move-filter-"]').forEach(select => {
                const charId = select.id.replace('move-filter-', '');
                new TomSelect(select, {
                    plugins: ['remove_button'],
                    onChange: () => filterMoves(charId)
                });
            });
        });
    </script>
    <script>
        function resetFilter(characterId) {
            const select = document.getElementById(`move-filter-${characterId}`);
            if (select && select.tomselect) {
                // Clear selected values in Tom Select
                select.tomselect.clear(true);
            }

            // Hide all move rows for this character
            const moveRows = document.querySelectorAll(`#move-table-${characterId} div[data-move-id]`);
            moveRows.forEach(div => div.style.display = 'none');
        }
    </script>
    <script>
    function toggleNoteForm(moveId) {
        const form = document.getElementById(`note-form-${moveId}`);
        if (form.style.display === 'none') {
            form.style.display = 'block';
        } else {
            form.style.display = 'none';
        }
    }
    </script>

<!-- Tom Select CSS and JS -->
<link href="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/css/tom-select.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/tom-select@2.2.2/dist/js/tom-select.complete.min.js"></script>
</body>
</html>